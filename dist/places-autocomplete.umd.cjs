(function(p,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(p=typeof globalThis<"u"?globalThis:p||self,g(p.PlacesAutocomplete={}))})(this,(function(p){"use strict";/**
 * Initialises a Places Autocomplete widget.
 * This script dynamically loads the Google Maps JavaScript API, creates the UI elements
 * for the autocomplete input and suggestions list, handles user input with debouncing,
 * fetches suggestions, manages keyboard navigation, and calls user-defined callbacks
 * on place selection or error.
 *
 * @author Alexander Pechkarev <alexpechkarev@gmail.com>
 * @license MIT
 *
 */class g{#u;#d;#m;#f;#e;#a;#t;#n;#s;#o;#c;#h;#l=[];#i=-1;#_;#r;_debouncedMakeAcRequest;#g={autofocus:!1,autocomplete:"off",placeholder:"Start typing your address ...",distance:!0,distance_units:"km",label:"",debounce:100,clear_input:!0,debug:!1};#p={section:"",container:"pac-container",icon_container:"pac-icon-container",icon:'<svg xmlns="http://www.w3.org/2000/svg" class="pac-w-5 pac-h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></svg>',input:"pac-input",kbd_container:"pac-kbd-container",kbd_escape:"pac-kbd-escape",kbd_up:"pac-kbd-up",kbd_down:"pac-kbd-down",kbd_active:"pac-kbd-active",ul:"pac-ul",li:"pac-li",li_current:"pac-li-current",li_a:"pac-li-a",li_a_current:"pac-li-a-current",li_div_container:"pac-li-div-container",li_div_one:"pac-li-div-one",li_div_one_p:"pac-li-div-one-p",li_div_two:"pac-li-div-two",li_div_two_p:"pac-li-div-two-p",highlight:"pac-highlight"};#b={input:"",includedRegionCodes:["GB"],language:"en-gb",region:"GB"};#v=["formattedAddress","addressComponents"];#y=["formattedAddress","addressComponents"];constructor(e){if(!e||!e.containerId||!e.googleMapsApiKey)throw new Error("PacAutocomplete: Missing required configuration (containerId, googleMapsApiKey).");if(this.#u=e.containerId,this.#d=document.getElementById(e.containerId),!this.#d)throw new Error(`PacAutocomplete: Container element with ID "${e.containerId}" not found.`);this.#m=e.googleMapsApiKey,this.#f=e.googleMapsApiVersion||"weekly",this.#e={...this.#g,...e.options},e.options&&e.options.classes?this.#e.classes={...this.#p,...e.options.classes}:this.#e.classes=this.#p,this.#e.debug&&(console.log("___debug constructor options:"),console.log(this.#e)),e.fetchFields&&Array.isArray(e.fetchFields)&&this._setFetchFields(e.fetchFields),this.#_=e.onResponse||(t=>{console.info("---------Default onResponse not provided---------"),console.info("Selected Place:",JSON.stringify(t,null,2))}),this.#r=e.onError||(t=>{console.error("---------Default onError not provided---------"),console.error("PAC Error:",t)}),e.requestParams&&Object.keys(e.requestParams).length>0?this.#a={...this.#b,...e.requestParams}:this.#a={...this.#b},this.#e.debug&&console.log("___debug constructor requestParams:",this.#a),this._initialiseDebouncedRequest(),this._init()}async _init(){try{(typeof google>"u"||!google.maps)&&await this._loadGoogleMapsApi({key:this.#m,v:this.#f}),this._createPACStructure(),await this._initializeAutocomplete()}catch(e){this.#r(e)}}_initialiseDebouncedRequest(){this._debouncedMakeAcRequest=this._debounce(async()=>{if(!this.#t||!this.#t.value){this._reset(),this.#t&&this.#t.setAttribute("aria-expanded","false");return}this.#a.input=this.#t.value;try{const{suggestions:e}=await google.maps.places.AutocompleteSuggestion.fetchAutocompleteSuggestions(this.#a);e&&e.length>0?(this.#s.replaceChildren(...this._createSuggestionElements(e)),this.#s.style.display="block",this.#t.setAttribute("aria-expanded","true")):(this._reset(),this.#t.setAttribute("aria-expanded","false"))}catch(e){this.#r(e),this._reset()}},this.#e.debounce)}_setFetchFields(e){Array.isArray(e)&&e.length>0&&(this.#v=[...new Set([...this.#y,...e])].filter(t=>t))}_debounce(e,t){this.#e.debug&&console.log("___debug debounce function called with wait:",t);let s=null;return function(...n){const l=()=>{s=null,e(...n)};s!==null&&clearTimeout(s),s=setTimeout(l,t??100)}}_formatDistance(e,t){if(typeof e!="number"||!this.#e.distance)return null;let s,i;return t==="km"?(s=(e/1e3).toFixed(2),i="km"):(s=(e/1609.34).toFixed(2),i="miles"),s=s.replace(/\.00$/,""),`${s} ${i}`}async _loadGoogleMapsApi(e){var t,s,i,n="The Google Maps JavaScript API",l="google",m="importLibrary",d="__ib__",f=document,r=window;r=r[l]||(r[l]={});var o=r.maps||(r.maps={}),u=new Set,_=new URLSearchParams,b=()=>t||(t=new Promise(async(c,a)=>{s=f.createElement("script"),_.set("libraries",[...u].join(","));for(i in e)_.set(i.replace(/[A-Z]/g,v=>"_"+v[0].toLowerCase()),e[i]);_.set("callback",l+".maps."+d),s.src=`https://maps.${l}apis.com/maps/api/js?`+_,o[d]=c,s.onerror=()=>t=a(new Error(`${n} could not load. Check your API key and network connection.`)),s.nonce=f.querySelector("script[nonce]")?.nonce||"",f.head.append(s)}));o[m]?console.warn(n+" only loads once. Ignoring:",e):o[m]=(c,...a)=>u.add(c)&&b().then(()=>o[m](c,...a))}_createPACStructure(){const e=document.createElement("section");e.className=this.#e.classes.section,this.#n=document.createElement("div"),this.#n.className=this.#e.classes.container,this.#n.setAttribute("id",this.#u+"-div"),e.appendChild(this.#n);const t=document.createElement("div");t.className=this.#e.classes.icon_container,this.#n.appendChild(t);const s=document.createElement("div");if(s.innerHTML=this.#e.classes.icon,t.appendChild(s.firstElementChild),this.#t=document.createElement("input"),this.#t.id=this.#u+"-input",this.#t.type="text",this.#t.name="search",this.#t.placeholder=this.#e.placeholder,this.#t.autocomplete=this.#e.autocomplete,this.#t.className=this.#e.classes.input,this.#t.setAttribute("role","combobox"),this.#t.setAttribute("aria-autocomplete","list"),this.#t.setAttribute("aria-expanded","false"),this.#t.setAttribute("aria-controls","pacSuggestions"),this.#t.setAttribute("aria-activedescendant",""),this.#e.autofocus&&(this.#t.autofocus=!0),this.#e.label){const n=document.createElement("label");n.htmlFor=this.#t.id,n.textContent=this.#e.label,e.prepend(n)}this.#n.appendChild(this.#t);const i=document.createElement("div");i.className=this.#e.classes.kbd_container,this.#o=document.createElement("kbd"),this.#o.className=this.#e.classes.kbd_escape,this.#o.textContent="Esc",i.appendChild(this.#o),this.#c=document.createElement("kbd"),this.#c.className=this.#e.classes.kbd_up,this.#c.innerHTML="&#8593;",i.appendChild(this.#c),this.#h=document.createElement("kbd"),this.#h.className=this.#e.classes.kbd_down,this.#h.innerHTML="&#8595;",i.appendChild(this.#h),this.#n.appendChild(i),this.#s=document.createElement("ul"),this.#s.id="pacSuggestions",this.#s.className=this.#e.classes.ul,this.#s.style.display="none",this.#s.setAttribute("role","listbox"),this.#s.setAttribute("aria-labelledby",this.#t.id),this.#n.appendChild(this.#s),this.#d.appendChild(e),e.addEventListener("keydown",this._onKeyDown.bind(this))}_attachedEventListeners(){this.#t.addEventListener("input",this._debouncedMakeAcRequest),this.#t.addEventListener("blur",()=>{setTimeout(()=>{this.#s&&!this.#s.contains(document.activeElement)&&(this.#s.style.display="none",this.#t.setAttribute("aria-expanded","false"))},200)}),this.#t.addEventListener("focus",()=>{this.#t.value&&this.#l.length>0&&(this.#s.style.display="block",this.#t.setAttribute("aria-expanded","true"))})}_detachEventListeners(){this.#t&&this.#t.removeEventListener("input",this._debouncedMakeAcRequest),this.#d&&this.#n&&this.#d.removeChild(this.#n.parentElement)}async _initializeAutocomplete(){try{await google.maps.importLibrary("places"),this._refreshToken(),this.#t?this._attachedEventListeners():this.#r(new Error("Input element not found during initialization."))}catch(e){console.error("Error initializing Google Places Autocomplete:",e),this.#r(new Error("Google Maps Places library not available."))}}_reset(e=!1,t=null){this.#i=-1,this.#t&&this.#e.clear_input==!1&&t&&t.formattedAddress?this.#t.value=t.formattedAddress:this.#t&&(this.#t.value=""),this.#t&&(this.#t.setAttribute("aria-expanded","false"),this.#t.setAttribute("aria-activedescendant",""),this.#t.blur()),this.#l=[],this.#i=-1,this.#s&&(this.#s.innerHTML="",this.#s.style.display="none"),e&&this._refreshToken()}_resetLiClasses(){this.#s&&Array.from(this.#s.children).forEach(e=>{this.#e.classes.li_current.split(" ").forEach(s=>e.classList.remove(s));const t=e.querySelector("a");t&&this.#e.classes.li_a_current.split(" ").forEach(s=>t.classList.remove(s))})}_onKeyDown(e){if(this._resetLiClasses(),e.key==="Escape"&&(e.preventDefault(),this.#e.classes.kbd_active.split(" ").forEach(t=>this.#o?.classList.add(t)),setTimeout(()=>this.#e.classes.kbd_active.split(" ").forEach(t=>this.#o?.classList.remove(t)),300),this._reset(!0)),!(!this.#l.length||!this.#s||this.#s.style.display==="none"))if(e.key==="ArrowDown"){e.preventDefault(),this.#i=Math.min(this.#i+1,this.#l.length-1),this.#i<0&&(this.#i=0);const t=this.#s.children.item(this.#i);if(t){const s=t.querySelector("a");this.#e.classes.li_current.split(" ").forEach(i=>t.classList.add(i)),s&&this.#e.classes.li_a_current.split(" ").forEach(i=>s.classList.add(i)),t.scrollIntoView({block:"nearest"}),this.#t.setAttribute("aria-activedescendant",t.id)}this.#e.classes.kbd_active.split(" ").forEach(s=>this.#h?.classList.add(s)),setTimeout(()=>this.#e.classes.kbd_active.split(" ").forEach(s=>this.#h?.classList.remove(s)),300)}else if(e.key==="ArrowUp"){e.preventDefault(),this.#i=Math.max(this.#i-1,0);const t=this.#s.children.item(this.#i);if(t){const s=t.querySelector("a");this.#e.classes.li_current.split(" ").forEach(i=>t.classList.add(i)),s&&this.#e.classes.li_a_current.split(" ").forEach(i=>s.classList.add(i)),t.scrollIntoView({block:"nearest"})}this.#e.classes.kbd_active.split(" ").forEach(s=>this.#c?.classList.add(s)),setTimeout(()=>this.#e.classes.kbd_active.split(" ").forEach(s=>this.#c?.classList.remove(s)),300)}else e.key==="Enter"&&(e.preventDefault(),this.#i>=0&&this.#i<this.#l.length&&this._onPlaceSelected(this.#l[this.#i].place))}_createSuggestionElements(e){return this.#l=[],e.map((t,s)=>{this.#l.push({id:s+1,description:t.placePrediction.toString(),place:t.placePrediction.toPlace()});const i=document.createElement("div");i.className=this.#e.classes.li_div_container;const n=document.createElement("div");n.className=this.#e.classes.li_div_one,i.appendChild(n);const l=document.createElement("p");l.className=this.#e.classes.li_div_one_p;const m=t.placePrediction.text,d=m.text,f=m.matches;let r=0;f.sort((h,y)=>h.startOffset-y.startOffset);const o=document.createElement("span"),u=document.createElement("span");u.classList=this.#e.classes.highlight??"font-bold";for(const h of f)o.textContent+=d.substring(r,h.startOffset),h.startOffset>0&&d.charAt(h.startOffset-1)==" "&&(u.textContent+=" "),u.textContent+=d.substring(h.startOffset,h.endOffset),r=h.endOffset;const _=document.createTextNode(d.substring(r));o.appendChild(u),o.appendChild(_),l.appendChild(o),n.appendChild(l),i.appendChild(n);const b=document.createElement("div");b.className=this.#e.classes.li_div_two,i.appendChild(b);const c=document.createElement("p");c.className=this.#e.classes.li_div_two_p,c.textContent=this._formatDistance(t.placePrediction.distanceMeters,this.#e.distance_units??"km"),b.appendChild(c);const a=document.createElement("a");a.href="javascript:void(0)",a.tabIndex=s+1,a.className=this.#e.classes.li_a,a.addEventListener("click",()=>{this._onPlaceSelected(t.placePrediction.toPlace())}),a.appendChild(i),a.appendChild(b);const v=document.createElement("li");return v.id=`option-${s+1}`,v.className=this.#e.classes.li,v.appendChild(a),v})}async _onPlaceSelected(e){let t=null;try{await e.fetchFields({fields:this.#v}),t=e.toJSON(),this.#_(t)}catch(s){console.error("Error fetching place details:",s),this.#r(s)}finally{this._reset(!0,t)}}_refreshToken(){try{this.#a.sessionToken=new google.maps.places.AutocompleteSessionToken}catch(e){console.error("Error creating session token:",e),this.#r(e)}}setFetchFields(e){this._setFetchFields(e)}getFetchFields(){return this.#v}setRequestParams(e){typeof e=="object"&&!Array.isArray(e)&&e!==null&&(e.input&&typeof e.input=="string"&&(this.#t.value=e.input),this.#a={...this.#b,...e})}getRequestParams(){return this.#a}setOptions(e){if(typeof e=="object"&&!Array.isArray(e)&&e!==null){this._detachEventListeners();const t=e.classes||{};delete e.classes,this.#e={...this.#g,...e},t&&typeof t=="object"&&Object.keys(t).length>0?this.#e.classes={...this.#p,...t}:this.#e.classes={...this.#p},this._initialiseDebouncedRequest(),this._createPACStructure(),this.#t&&this._attachedEventListeners()}}getOptions(){return this.#e}clear(){this._reset(!0)}destroy(){this._detachEventListeners(),this.#u=null,this.#d=null,this.#m=null,this.#f=null,this.#e=null,this.#a=null,this.#t=null,this.#n=null,this.#s=null,this.#o=null,this.#c=null,this.#h=null,this.#l=null,this.#i=-1,this.#_=null,this.#r=null,this._debouncedMakeAcRequest=null,console.log("PacAutocomplete instance destroyed.")}}p.PlacesAutocomplete=g,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=places-autocomplete.umd.cjs.map
